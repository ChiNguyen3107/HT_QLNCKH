<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Bootstrap Tabs</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Debug Bootstrap Tab Functionality</h2>
        
        <div class="alert alert-info">
            <strong>Debug Steps:</strong>
            <ol>
                <li>Check if Bootstrap CSS/JS loads properly</li>
                <li>Test basic tab functionality without custom JS</li>
                <li>Check console for errors</li>
                <li>Test custom event handlers</li>
            </ol>
        </div>
        
        <!-- Basic Bootstrap Tabs -->
        <ul class="nav nav-tabs mb-3" id="debugTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab">Tab 1</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab">Tab 2</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tab3-tab" data-toggle="tab" href="#tab3" role="tab">Tab 3</a>
            </li>
        </ul>
        
        <div class="tab-content" id="debugTabContent">
            <div class="tab-pane fade show active" id="tab1" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5>Tab 1 Content</h5>
                        <p>This is tab 1 content.</p>
                        <button class="btn btn-primary" onclick="testFunction()">Test JS Function</button>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="tab2" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5>Tab 2 Content</h5>
                        <p>This is tab 2 content.</p>
                        <button class="btn btn-success" onclick="activateTab('tab3')">Go to Tab 3</button>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="tab3" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5>Tab 3 Content</h5>
                        <p>This is tab 3 content.</p>
                        <button class="btn btn-warning" onclick="activateTab('tab1')">Go to Tab 1</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Debug Info -->
        <div class="card mt-4">
            <div class="card-header">Debug Information</div>
            <div class="card-body">
                <div id="debugInfo">
                    <p><strong>jQuery Version:</strong> <span id="jqueryVersion">-</span></p>
                    <p><strong>Bootstrap JS Loaded:</strong> <span id="bootstrapLoaded">-</span></p>
                    <p><strong>Active Tab:</strong> <span id="activeTab">-</span></p>
                    <p><strong>Tab Count:</strong> <span id="tabCount">-</span></p>
                    <p><strong>Errors:</strong> <span id="errorCount">0</span></p>
                </div>
                <button class="btn btn-info" onclick="runDiagnostics()">Run Diagnostics</button>
                <button class="btn btn-secondary" onclick="clearErrors()">Clear Errors</button>
            </div>
        </div>
        
        <!-- Error Log -->
        <div class="card mt-3">
            <div class="card-header">Error Log</div>
            <div class="card-body">
                <div id="errorLog" style="font-family: monospace; background: #f8f9fa; padding: 10px; min-height: 100px;">
                    No errors logged yet.
                </div>
            </div>
        </div>
    </div>

    <!-- Load Libraries -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let errorCount = 0;
        
        // Capture all errors
        window.addEventListener('error', function(e) {
            logError('Global Error: ' + e.message + ' at ' + e.filename + ':' + e.lineno);
        });
        
        // Capture unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            logError('Unhandled Promise Rejection: ' + e.reason);
        });
        
        function logError(message) {
            errorCount++;
            const timestamp = new Date().toLocaleTimeString();
            const errorLog = document.getElementById('errorLog');
            if (errorLog.innerText === 'No errors logged yet.') {
                errorLog.innerHTML = '';
            }
            errorLog.innerHTML += `[${timestamp}] ${message}<br>`;
            document.getElementById('errorCount').innerText = errorCount;
        }
        
        function clearErrors() {
            errorCount = 0;
            document.getElementById('errorLog').innerHTML = 'No errors logged yet.';
            document.getElementById('errorCount').innerText = '0';
        }
        
        function testFunction() {
            alert('JavaScript is working!');
            logError('Test: JavaScript function executed successfully');
        }
        
        function activateTab(tabId) {
            try {
                $('a[href="#' + tabId + '"]').tab('show');
                logError('Test: Programmatically activated tab ' + tabId);
            } catch (e) {
                logError('Error activating tab: ' + e.message);
            }
        }
        
        function runDiagnostics() {
            try {
                // Check jQuery
                if (typeof $ !== 'undefined') {
                    document.getElementById('jqueryVersion').innerText = $.fn.jquery || 'Unknown';
                } else {
                    document.getElementById('jqueryVersion').innerText = 'NOT LOADED';
                    logError('jQuery is not loaded');
                }
                
                // Check Bootstrap
                if (typeof $.fn.tab !== 'undefined') {
                    document.getElementById('bootstrapLoaded').innerText = 'YES';
                } else {
                    document.getElementById('bootstrapLoaded').innerText = 'NO';
                    logError('Bootstrap JS tab functionality not available');
                }
                
                // Check active tab
                const activeTab = $('.nav-tabs .nav-link.active').attr('href');
                document.getElementById('activeTab').innerText = activeTab || 'None';
                
                // Check tab count
                const tabCount = $('.nav-tabs .nav-link').length;
                document.getElementById('tabCount').innerText = tabCount;
                
                logError('Diagnostics completed successfully');
                
            } catch (e) {
                logError('Error running diagnostics: ' + e.message);
            }
        }
        
        $(document).ready(function() {
            console.log('Document ready');
            runDiagnostics();
            
            // Test basic tab events
            $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {
                console.log('Tab show event:', e.target);
                logError('Tab show event: ' + $(e.target).attr('href'));
            });
            
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                console.log('Tab shown event:', e.target);
                logError('Tab shown event: ' + $(e.target).attr('href'));
                runDiagnostics();
            });
            
            // Update debug info every 2 seconds
            setInterval(runDiagnostics, 2000);
        });
    </script>
</body>
</html>
