<!DOCTYPE html>
<html>
<head>
    <title>Debug Evaluation System</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { background: #f0f0f0; padding: 15px; border: 1px solid #ccc; margin: 10px 0; white-space: pre-wrap; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
    </style>
</head>
<body>
    <h2>Debug Evaluation System</h2>
    
    <div id="result"></div>
    
    <button onclick="testEvaluationDebug()">Test with Debug Info</button>
    <button onclick="testWithRealSession()">Test with Real Session</button>
    <button onclick="clearResults()">Clear Results</button>
    
    <script>
    function testEvaluationDebug() {
        $('#result').html('<div class="result">Testing evaluation with debug...</div>');
        
        const formData = new FormData();
        formData.append('project_id', 'DT0000001');
        formData.append('member_id', 'GV000002');
        formData.append('criteria_id[]', 'TC001');
        formData.append('criteria_id[]', 'TC002');
        formData.append('criteria_id[]', 'TC003');
        formData.append('criteria_id[]', 'TC004');
        formData.append('criteria_id[]', 'TC005');
        formData.append('score[]', '8.5');
        formData.append('score[]', '12.0');
        formData.append('score[]', '13.5');
        formData.append('score[]', '25.0');
        formData.append('score[]', '12.5');
        formData.append('criteria_comments[]', 'Good overview');
        formData.append('criteria_comments[]', 'Clear objectives');
        formData.append('criteria_comments[]', 'Sound methodology');
        formData.append('criteria_comments[]', 'Excellent content');
        formData.append('criteria_comments[]', 'Good contribution');
        formData.append('overall_comment', 'This is a comprehensive evaluation with detailed debug info.');
        formData.append('is_completed', '1');
        
        $.ajax({
            url: 'view/student/update_member_criteria_score_debug.php',
            method: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            dataType: 'json',
            beforeSend: function(xhr) {
                xhr.setRequestHeader('X-Student-ID', 'B2110051');
            },
            success: function(response) {
                let resultClass = response.success ? 'success' : 'error';
                let output = 'RESULT: ' + (response.success ? 'SUCCESS' : 'FAILED') + '\n\n';
                output += 'Message: ' + response.message + '\n\n';
                
                if (response.debug_log) {
                    output += 'DEBUG LOG:\n';
                    response.debug_log.forEach(function(log, index) {
                        output += (index + 1) + '. ' + log + '\n';
                    });
                }
                
                if (response.success) {
                    output += '\nTotal Score: ' + response.total_score + '\n';
                    output += 'Affected Rows: ' + response.affected_rows + '\n';
                } else {
                    output += '\nError Details:\n';
                    output += 'File: ' + (response.file || 'Unknown') + '\n';
                    output += 'Line: ' + (response.line || 'Unknown') + '\n';
                    if (response.trace) {
                        output += '\nStack Trace:\n' + response.trace + '\n';
                    }
                }
                
                $('#result').html('<div class="result ' + resultClass + '">' + output + '</div>');
            },
            error: function(xhr, status, error) {
                $('#result').html('<div class="result error">AJAX Error:\nStatus: ' + status + '\nError: ' + error + '\nResponse: ' + xhr.responseText + '</div>');
            }
        });
    }
    
    function testWithRealSession() {
        $('#result').html('<div class="result">Testing with simulated real session...</div>');
        
        // First set up session, then test
        window.open('test_real_form.php', '_blank');
    }
    
    function clearResults() {
        $('#result').html('');
    }
    </script>
    
    <h3>Test Parameters:</h3>
    <ul>
        <li><strong>Student ID:</strong> B2110051 (simulated via header)</li>
        <li><strong>Project ID:</strong> DT0000001</li>
        <li><strong>Member ID:</strong> GV000002</li>
        <li><strong>Criteria:</strong> TC001 to TC005</li>
        <li><strong>Total Score:</strong> 71.5 points</li>
    </ul>
</body>
</html>
