<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Tab Structure Test</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h3>New Tab Structure - Clean Approach</h3>
        <p>Current Tab: <strong id="currentTabInfo">proposal</strong></p>
        
        <!-- New Tab Navigation - Button Style -->
        <div class="nav-buttons mb-4">
            <button class="btn btn-outline-primary tab-btn active" data-tab="proposal">
                <i class="fas fa-file-alt"></i> Thuyết minh
            </button>
            <button class="btn btn-outline-primary tab-btn" data-tab="contract">
                <i class="fas fa-file-contract"></i> Hợp đồng
            </button>
            <button class="btn btn-outline-primary tab-btn" data-tab="decision">
                <i class="fas fa-file-signature"></i> Quyết định
            </button>
            <button class="btn btn-outline-primary tab-btn" data-tab="report">
                <i class="fas fa-file-invoice"></i> Biên bản
            </button>
            <button class="btn btn-outline-primary tab-btn" data-tab="evaluation">
                <i class="fas fa-clipboard-check"></i> Đánh giá
            </button>
        </div>

        <!-- Tab Content - Only ONE div at a time -->
        <div class="tab-container">
            <div id="tab-content-area">
                <!-- Content will be loaded here dynamically -->
            </div>
        </div>
        
        <div class="mt-4">
            <button class="btn btn-info btn-sm" onclick="showTabInfo()">Show Tab Info</button>
            <button class="btn btn-warning btn-sm" onclick="switchToTab('report')">Switch to Report</button>
            <a href="?tab=report" class="btn btn-success btn-sm">Test URL ?tab=report</a>
        </div>
        
        <div id="debugInfo" class="mt-3"></div>
    </div>

    <style>
        .tab-btn {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .tab-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .tab-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        .tab-content-section {
            display: block;
        }
    </style>

    <script>
        // Tab content templates
        const tabContents = {
            proposal: `
                <div class="tab-content-section">
                    <h4><i class="fas fa-file-alt text-primary"></i> Thuyết minh đề tài</h4>
                    <div class="card">
                        <div class="card-body">
                            <h6>File thuyết minh hiện tại</h6>
                            <p>Nội dung thuyết minh của đề tài...</p>
                            <button class="btn btn-primary btn-sm">
                                <i class="fas fa-download"></i> Tải xuống
                            </button>
                        </div>
                    </div>
                </div>
            `,
            contract: `
                <div class="tab-content-section">
                    <h4><i class="fas fa-file-contract text-success"></i> Hợp đồng thực hiện</h4>
                    <div class="card">
                        <div class="card-body">
                            <h6>Thông tin hợp đồng</h6>
                            <p>Chi tiết hợp đồng thực hiện đề tài...</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Mã hợp đồng:</strong> HD001
                                </div>
                                <div class="col-md-6">
                                    <strong>Ngày ký:</strong> 01/01/2025
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            decision: `
                <div class="tab-content-section">
                    <h4><i class="fas fa-file-signature text-warning"></i> Quyết định nghiệm thu</h4>
                    <div class="card">
                        <div class="card-body">
                            <h6>Quyết định thành lập hội đồng</h6>
                            <p>Thông tin quyết định nghiệm thu...</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Số quyết định:</strong> QD001
                                </div>
                                <div class="col-md-6">
                                    <strong>Ngày ra quyết định:</strong> 15/12/2024
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            report: `
                <div class="tab-content-section">
                    <h4><i class="fas fa-file-invoice text-info"></i> Biên bản nghiệm thu</h4>
                    <div class="card">
                        <div class="card-body">
                            <h6>Thông tin biên bản</h6>
                            <p>Chi tiết biên bản nghiệm thu đề tài...</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Ngày nghiệm thu:</strong> 20/12/2024
                                </div>
                                <div class="col-md-6">
                                    <strong>Kết quả:</strong> <span class="badge badge-success">Đạt</span>
                                </div>
                            </div>
                            <hr>
                            <h6>Thành viên hội đồng</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-2">
                                        <div class="card-body py-2">
                                            <strong>PGS.TS Nguyễn Văn A</strong>
                                            <span class="badge badge-warning ml-2">Chủ tịch</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-2">
                                        <div class="card-body py-2">
                                            <strong>TS. Trần Thị B</strong>
                                            <span class="badge badge-info ml-2">Thành viên</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary btn-sm mt-2">
                                <i class="fas fa-edit"></i> Cập nhật thành viên hội đồng
                            </button>
                        </div>
                    </div>
                </div>
            `,
            evaluation: `
                <div class="tab-content-section">
                    <h4><i class="fas fa-clipboard-check text-danger"></i> Đánh giá nghiệm thu</h4>
                    <div class="card">
                        <div class="card-body">
                            <h6>Kết quả đánh giá</h6>
                            <p>Chi tiết đánh giá của hội đồng nghiệm thu...</p>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h3 class="text-success">85</h3>
                                        <small>Điểm trung bình</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h3 class="text-info">Tốt</h3>
                                        <small>Xếp loại</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h3 class="text-warning">5/5</h3>
                                        <small>Thành viên đã chấm</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        };
        
        let currentTab = 'proposal';
        
        $(document).ready(function() {
            console.log('=== NEW TAB STRUCTURE PAGE LOADED ===');
            
            // Initialize from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const urlTab = urlParams.get('tab');
            if (urlTab && tabContents[urlTab]) {
                currentTab = urlTab;
            }
            
            // Load initial tab
            switchToTab(currentTab);
            
            // Handle button clicks
            $('.tab-btn').click(function() {
                const tabName = $(this).data('tab');
                switchToTab(tabName);
                updateUrl(tabName);
            });
        });
        
        function switchToTab(tabName) {
            if (!tabContents[tabName]) {
                console.log('Tab content not found:', tabName);
                return;
            }
            
            console.log('Switching to tab:', tabName);
            
            // Update button states
            $('.tab-btn').removeClass('active');
            $('.tab-btn[data-tab="' + tabName + '"]').addClass('active');
            
            // Load content - REPLACE entire content area
            $('#tab-content-area').html(tabContents[tabName]);
            
            // Update current tab
            currentTab = tabName;
            $('#currentTabInfo').text(tabName);
            
            // Store in session
            sessionStorage.setItem('activeTab', tabName);
            
            console.log('Tab switched to:', tabName);
        }
        
        function updateUrl(tabName) {
            if (history.pushState) {
                const newUrl = window.location.pathname + '?tab=' + tabName;
                history.pushState(null, null, newUrl);
                console.log('URL updated to:', newUrl);
            }
        }
        
        function showTabInfo() {
            const info = `
                <div class="alert alert-info">
                    <strong>Current Tab:</strong> ${currentTab}<br>
                    <strong>Active Button:</strong> ${$('.tab-btn.active').data('tab')}<br>
                    <strong>Content Area Children:</strong> ${$('#tab-content-area').children().length}<br>
                    <strong>URL Parameter:</strong> ${new URLSearchParams(window.location.search).get('tab') || 'none'}<br>
                    <strong>Session Storage:</strong> ${sessionStorage.getItem('activeTab') || 'none'}
                </div>
            `;
            $('#debugInfo').html(info);
        }
    </script>
</body>
</html>
