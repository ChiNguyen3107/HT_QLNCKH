<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test New Tab System Implementation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h3>✅ New Tab System Implementation Applied</h3>
        
        <div class="alert alert-success">
            <h5><i class="fas fa-check-circle mr-2"></i>Áp dụng thành công!</h5>
            <p>Force Visible Tab System đã được áp dụng vào <code>view_project.php</code></p>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link simple-tab active" data-tab="proposal" href="#" id="proposal-tab">
                    <i class="fas fa-file-alt mr-1"></i> Thuyết minh
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link simple-tab" data-tab="contract" href="#" id="contract-tab">
                    <i class="fas fa-file-contract mr-1"></i> Hợp đồng
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link simple-tab" data-tab="decision" href="#" id="decision-tab">
                    <i class="fas fa-file-signature mr-1"></i> Quyết định
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link simple-tab" data-tab="report" href="#" id="report-tab">
                    <i class="fas fa-file-invoice mr-1"></i> Biên bản
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link simple-tab" data-tab="evaluation" href="#" id="evaluation-tab">
                    <i class="fas fa-clipboard-check mr-1"></i> Đánh giá
                </a>
            </li>
        </ul>

        <!-- Single Content Area (Same as view_project.php) -->
        <div class="tab-content" id="documentTabsContent">
            <div id="single-tab-content" style="
                padding: 20px !important; 
                border: 1px solid #dee2e6 !important; 
                border-radius: 8px !important; 
                background: #f8f9fa !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                position: relative !important;
                z-index: 100 !important;
                min-height: 300px !important;
            ">
                <!-- Content will be loaded here dynamically -->
                <div class="text-center text-muted">
                    <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                    <p>Đang tải nội dung...</p>
                </div>
            </div>
        </div>

        <!-- Implementation Summary -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0"><i class="fas fa-check mr-2"></i>Changes Applied</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-0">
                            <li>✅ Single content area with force visibility</li>
                            <li>✅ Template-based content loading</li>
                            <li>✅ Force CSS injection system</li>
                            <li>✅ Error handling with debug info</li>
                            <li>✅ URL parameter support</li>
                            <li>✅ Back/forward navigation</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0"><i class="fas fa-info mr-2"></i>How It Works</h6>
                    </div>
                    <div class="card-body">
                        <ol class="mb-0">
                            <li><strong>Force CSS:</strong> Ensures content visibility</li>
                            <li><strong>Template System:</strong> No more hide/show</li>
                            <li><strong>Content Replacement:</strong> Complete innerHTML swap</li>
                            <li><strong>Multiple Methods:</strong> DOM + jQuery + styles</li>
                            <li><strong>Error Recovery:</strong> Debug info on failures</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Instructions -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0"><i class="fas fa-play mr-2"></i>Để test trên view_project.php thật:</h6>
                </div>
                <div class="card-body">
                    <p><strong>URL format:</strong></p>
                    <code>http://localhost/NLNganh/view/student/view_project.php?project_id=YOUR_PROJECT_ID</code>
                    
                    <p class="mt-3"><strong>Tab URL parameters:</strong></p>
                    <ul>
                        <li><code>?project_id=123&tab=proposal</code> - Thuyết minh</li>
                        <li><code>?project_id=123&tab=contract</code> - Hợp đồng</li>
                        <li><code>?project_id=123&tab=decision</code> - Quyết định</li>
                        <li><code>?project_id=123&tab=report</code> - Biên bản</li>
                        <li><code>?project_id=123&tab=evaluation</code> - Đánh giá</li>
                    </ul>
                    
                    <p class="mt-3"><strong>Debug:</strong> Mở Browser Console (F12) để xem logs</p>
                </div>
            </div>
        </div>

        <!-- Hidden Templates (Same as view_project.php) -->
        <div style="display: none;" id="content-templates">
            <!-- Template Thuyết minh -->
            <div id="template-proposal">
                <div class="alert alert-info">
                    <h5><i class="fas fa-file-alt mr-2"></i>Thuyết minh đề tài</h5>
                    <p>Template demo - tab switching hoạt động!</p>
                    <p><strong>Tab:</strong> Proposal</p>
                    <p><strong>Load time:</strong> <span id="load-time-proposal"></span></p>
                    <div class="badge badge-info">Template working!</div>
                </div>
            </div>
            
            <!-- Template Hợp đồng -->
            <div id="template-contract">
                <div class="alert alert-success">
                    <h5><i class="fas fa-file-contract mr-2"></i>Hợp đồng thực hiện</h5>
                    <p>Template demo - content replacement thành công!</p>
                    <p><strong>Tab:</strong> Contract</p>
                    <p><strong>Load time:</strong> <span id="load-time-contract"></span></p>
                    <div class="badge badge-success">Template working!</div>
                </div>
            </div>
            
            <!-- Template Quyết định -->
            <div id="template-decision">
                <div class="alert alert-warning">
                    <h5><i class="fas fa-file-signature mr-2"></i>Quyết định nghiệm thu</h5>
                    <p>Template demo - force visibility hoạt động!</p>
                    <p><strong>Tab:</strong> Decision</p>
                    <p><strong>Load time:</strong> <span id="load-time-decision"></span></p>
                    <div class="badge badge-warning">Template working!</div>
                </div>
            </div>
            
            <!-- Template Biên bản -->
            <div id="template-report">
                <div class="alert alert-primary">
                    <h5><i class="fas fa-file-invoice mr-2"></i>Biên bản nghiệm thu</h5>
                    <p>Template demo - no more "all tabs showing"!</p>
                    <p><strong>Tab:</strong> Report</p>
                    <p><strong>Load time:</strong> <span id="load-time-report"></span></p>
                    <div class="badge badge-primary">Template working!</div>
                </div>
            </div>
            
            <!-- Template Đánh giá -->
            <div id="template-evaluation">
                <div class="alert alert-danger">
                    <h5><i class="fas fa-clipboard-check mr-2"></i>Đánh giá nghiệm thu</h5>
                    <p>Template demo - solution applied successfully!</p>
                    <p><strong>Tab:</strong> Evaluation</p>
                    <p><strong>Load time:</strong> <span id="load-time-evaluation"></span></p>
                    <div class="badge badge-danger">Template working!</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Same JavaScript as implemented in view_project.php
        $(document).ready(function() {
            initializeTabs();
        });

        function initializeTabs() {
            console.log('=== INITIALIZING FORCE VISIBLE TAB SYSTEM ===');
            
            injectForceVisibilityCSS();
            
            const urlParams = new URLSearchParams(window.location.search);
            const initialTab = urlParams.get('tab') || 'proposal';
            
            forceLoadTabContent(initialTab);
            updateActiveTab(initialTab);
            
            $('.simple-tab').off('click').on('click', function(e) {
                e.preventDefault();
                const tabName = $(this).data('tab');
                console.log('=== TAB CLICKED:', tabName, '===');
                forceLoadTabContent(tabName);
                updateActiveTab(tabName);
                updateUrl(tabName);
            });
            
            window.addEventListener('popstate', function(event) {
                const urlParams = new URLSearchParams(window.location.search);
                const urlTab = urlParams.get('tab') || 'proposal';
                console.log('=== URL CHANGED (POPSTATE):', urlTab, '===');
                forceLoadTabContent(urlTab);
                updateActiveTab(urlTab);
            });
            
            console.log('✅ Force visible tab system initialized');
        }
        
        function injectForceVisibilityCSS() {
            $('#force-tab-styles').remove();
            
            const forceCSS = `
                <style id="force-tab-styles">
                    #single-tab-content {
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        position: relative !important;
                        z-index: 100 !important;
                        background: #ffffff !important;
                        border: 1px solid #dee2e6 !important;
                        padding: 20px !important;
                        min-height: 300px !important;
                    }
                    
                    #content-templates {
                        display: none !important;
                        visibility: hidden !important;
                    }
                    
                    .simple-pane {
                        display: none !important;
                    }
                </style>
            `;
            
            $('head').append(forceCSS);
            console.log('✅ Force visibility CSS injected');
        }
        
        function forceLoadTabContent(tabName) {
            console.log('=== FORCE LOADING TAB CONTENT:', tabName, '===');
            
            try {
                const contentArea = document.getElementById('single-tab-content');
                if (!contentArea) {
                    console.error('❌ Content area not found');
                    return;
                }
                
                const templateElement = document.getElementById('template-' + tabName);
                if (!templateElement) {
                    console.error('❌ Template not found for:', tabName);
                    return;
                }
                
                const templateContent = templateElement.innerHTML;
                if (!templateContent || templateContent.trim().length === 0) {
                    console.error('❌ Template content empty for:', tabName);
                    return;
                }
                
                console.log('✅ Template found, content length:', templateContent.length);
                
                contentArea.innerHTML = '';
                contentArea.innerHTML = templateContent;
                
                contentArea.style.display = 'block';
                contentArea.style.visibility = 'visible';
                contentArea.style.opacity = '1';
                contentArea.style.position = 'relative';
                contentArea.style.zIndex = '100';
                
                if (typeof $ !== 'undefined') {
                    $('#single-tab-content').css({
                        'display': 'block',
                        'visibility': 'visible',
                        'opacity': '1'
                    });
                }
                
                const loadTimeElement = document.getElementById('load-time-' + tabName);
                if (loadTimeElement) {
                    loadTimeElement.textContent = new Date().toLocaleTimeString();
                }
                
                console.log('✅ Content force loaded for tab:', tabName);
                
            } catch (error) {
                console.error('❌ ERROR in forceLoadTabContent:', error);
            }
        }
        
        function updateActiveTab(tabName) {
            $('.simple-tab').removeClass('active');
            $('.simple-tab[data-tab="' + tabName + '"]').addClass('active');
        }
        
        function updateUrl(tabName) {
            if (history.pushState) {
                const newUrl = window.location.pathname + '?tab=' + tabName;
                history.pushState(null, null, newUrl);
                console.log('✅ URL updated to:', newUrl);
            }
        }
    </script>
</body>
</html>
