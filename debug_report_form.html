<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Form Biên Bản</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-box { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        form { background: white; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Debug Form Biên Bản Nghiệm Thu</h1>
    
    <div class="debug-box">
        <h3>Form Debug Information</h3>
        <div id="debugInfo">
            <p>Kiểm tra các field cần thiết cho form biên bản...</p>
        </div>
    </div>

    <form action="debug_report_backend.php" method="post" enctype="multipart/form-data" id="testForm">
        <h3>Test Form Biên Bản Nghiệm Thu</h3>
        
        <input type="hidden" name="project_id" value="TEST_PROJECT_ID">
        <input type="hidden" name="decision_id" value="TEST_DECISION_ID">
        <input type="hidden" name="report_id" value="TEST_REPORT_ID">
        
        <div class="form-group">
            <label for="acceptance_date">Ngày nghiệm thu *</label>
            <input type="date" id="acceptance_date" name="acceptance_date" required>
        </div>
        
        <div class="form-group">
            <label for="evaluation_grade">Xếp loại đánh giá *</label>
            <select id="evaluation_grade" name="evaluation_grade" required>
                <option value="">-- Chọn xếp loại --</option>
                <option value="Xuất sắc">Xuất sắc</option>
                <option value="Tốt">Tốt</option>
                <option value="Khá">Khá</option>
                <option value="Đạt">Đạt</option>
                <option value="Không đạt">Không đạt</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="total_score">Tổng điểm đánh giá</label>
            <input type="number" id="total_score" name="total_score" min="0" max="100" step="0.1">
        </div>
        
        <div class="form-group">
            <label for="council_members">Thành viên hội đồng</label>
            <textarea id="council_members" name="council_members" rows="4" placeholder="Danh sách thành viên hội đồng..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="report_update_reason">Lý do cập nhật *</label>
            <textarea id="report_update_reason" name="update_reason" rows="3" required placeholder="Nhập lý do cập nhật thông tin biên bản..."></textarea>
        </div>
        
        <button type="submit">Gửi Test Form</button>
        <button type="button" onclick="debugForm()">Debug Form Data</button>
    </form>

    <div class="debug-box" id="formOutput" style="display: none;">
        <h3>Form Data Output</h3>
        <pre id="formData"></pre>
    </div>

    <script>
        function debugForm() {
            const form = $('#testForm');
            const formData = {
                project_id: form.find('input[name="project_id"]').val(),
                decision_id: form.find('input[name="decision_id"]').val(),
                report_id: form.find('input[name="report_id"]').val(),
                acceptance_date: form.find('#acceptance_date').val(),
                evaluation_grade: form.find('#evaluation_grade').val(),
                total_score: form.find('#total_score').val(),
                council_members: form.find('#council_members').val(),
                update_reason: form.find('#report_update_reason').val()
            };
            
            $('#formData').text(JSON.stringify(formData, null, 2));
            $('#formOutput').show();
            
            // Check required fields
            let missingFields = [];
            if (!formData.project_id) missingFields.push('project_id');
            if (!formData.decision_id) missingFields.push('decision_id');
            if (!formData.acceptance_date) missingFields.push('acceptance_date');
            if (!formData.evaluation_grade) missingFields.push('evaluation_grade');
            if (!formData.update_reason) missingFields.push('update_reason');
            
            if (missingFields.length > 0) {
                $('#debugInfo').html(`
                    <div class="error">
                        <h4>❌ Missing Required Fields:</h4>
                        <ul>${missingFields.map(field => `<li>${field}</li>`).join('')}</ul>
                    </div>
                `);
            } else {
                $('#debugInfo').html(`
                    <div class="success">
                        <h4>✅ All Required Fields Present</h4>
                        <p>Form is ready for submission.</p>
                    </div>
                `);
            }
        }
        
        // Auto-check on page load
        $(document).ready(function() {
            // Set default values for testing
            $('#acceptance_date').val(new Date().toISOString().split('T')[0]);
            $('#evaluation_grade').val('Tốt');
            $('#total_score').val('85');
            $('#council_members').val('Test Member 1 (Chủ tịch)\nTest Member 2 (Thành viên)');
            $('#report_update_reason').val('Test update reason for debugging');
            
            debugForm();
        });
        
        // Allow actual form submission for testing
        $('#testForm').on('submit', function(e) {
            // Don't prevent default - let it submit to debug backend
            debugForm();
        });
    </script>
</body>
</html>
